<script src = "https://unpkg.com/matrix-api/dist/matrix-api.standalone.js"></script>

<button id="but" >Click Me!</button> 

<button onclick="display()">Send Message</button>



<input type="text" id="input1" placeholder="showID">
<input type="number" id="input2" placeholder="LikeRating">
<input type="email" id="input3" placeholder="Tags">

<button onclick="readInputs()">Read Inputs</button>

<div id="output"></div>
</br>
</br>
</br>
</br>
</br>
</br>
</br>
</br>
user1
<div id="output1"></div>
</br>
</br>
</br>
</br>
</br>
</br>
</br>
user2
<div id="output2"></div>
</br>
</br>
</br>
</br>
</br>
</br>
user3
<div id="output3"></div>


</br>
</br>
</br>
</br>
user3
<div id="rec"></div>

<script type="text/javascript">




	const u1 = [
  	{
    id: "A",
    rating: 0.5,
    tags: ["electronics", "gadgets", "smart home"]
  	},
  	{
    id: "B",
    rating: 0.8,
    tags: ["kitchen", "cooking", "appliances"]
  	},
  	{
    id: "C",
    rating:0.6,
    tags: ["sports", "fitness", "outdoors"]
  	},
  	{
    id: "D",
    rating: 0.4,
    tags: ["books", "reading", "education"]
  	}
	];


	const u2 = [
  	{
    id: "D",
    rating: 0.8,
    tags: ["electronics", "gadgets", "smart home"]
  	},
  	{
    id: "F",
    rating: 0.6,
    tags: ["kitchen", "cooking", "appliances"]
  	},
  	{
    id: "A",
    rating: 1,
    tags: ["sports", "fitness", "outdoors"]
  	},
  	{
    id: "G",
    rating: 0.9,
    tags: ["books", "reading", "education"]
  	}
	];

	const u3 = [
  	{
    id: "F",
    rating: 0.8,
    tags: ["electronics", "gadgets", "smart home"]
  	},
  	{
    id: "G",
    rating: 0.6,
    tags: ["kitchen", "cooking", "appliances"]
  	},
  	{
    id: "B",
    rating: 1,
    tags: ["sports", "fitness", "outdoors"]
  	},
  	{
    id: "C",
    rating: 0.9,
    tags: ["books", "reading", "education"]
  	}
	];


 	outputDiv = document.getElementById("output1");
	let html = "";
	for (let i = 0; i < u1.length; i++) {

	html += "<p>id: " + u1[i].id + ", Age: " + u1[i].rating +", tags: " + u1[i].tags + "</p>";
	}
	outputDiv.innerHTML = html;



 	outputDiv = document.getElementById("output2");
 	html = "";
	for (let i = 0; i < u2.length; i++) {
	console.log(u2[i])
	html += "<p>id: " + u2[i].id + ", Age: " + u2[i].rating +", tags: " + u2[i].tags + "</p>";
	}
	outputDiv.innerHTML = html;

 	outputDiv = document.getElementById("output3");
 	html = "";
	for (let i = 0; i < u3.length; i++) {
	console.log(u2[i])
	html += "<p>id: " + u3[i].id + ", Age: " + u3[i].rating +", tags: " + u3[i].tags + "</p>";
	}
	outputDiv.innerHTML = html;


</script>


<script type="text/javascript">
function sim(){
	console.log(u1);
	console.log(u2);
	console.log(u3);

	users=[u1,u2,u3];
	arrayof_ids=[]
	dirrectory_ids=[]
	usersimscore=[0,0,0];
	for (var i = 0; i < users.length; i++) {
		console.log("users")
		console.log(users[i])
		for (var j = 0; j < users[i].length; j++) {
			users[i][j];
			console.log(users[i][j]);

			if (!arrayof_ids.includes(users[i][j].id)){
				arrayof_ids.push(users[i][j].id);
				dirrectory_ids.push([users[i][j].id,""])
				dirrectory_ids.push([i,users[i][j].rating])
				for (var p = 0; p < dirrectory_ids.length; p++) {
					if (dirrectory_ids[p][0]==users[i][j].id){
						dirrectory_ids[p].push([i,users[i][j].rating])
					}
				}
			}
			else{
				console.log("")
				for (var p = 0; p < dirrectory_ids.length; p++) {
					if (dirrectory_ids[p][0]==users[i][j].id){
						dirrectory_ids[p].push([i,users[i][j].rating])
					}
				}
			}


			for (var z = 0; z < arrayofparts.length; z++) {
				if (arrayofparts[z].id==users[i][j].id){
					console.log("inhere");
					usersimscore[i]+=0.4-Math.abs((arrayofparts[z].rating-users[i][j].rating))
				}
			};


		};	
	};
	console.log(dirrectory_ids);
	console.log(usersimscore);
	aRec=[]
	for (var i = 0; i < dirrectory_ids.length; i++) {
		val=0;
		for (var j = 2; j < dirrectory_ids[i].length; j++) {
			val+=0.01+usersimscore[dirrectory_ids[i][j][0]]*dirrectory_ids[i][j][1];
		}
		console.log([dirrectory_ids[i][0],val])
		aRec.push([dirrectory_ids[i][0],val])

	};
	console.log(aRec);

	sortedArr = aRec.sort((a, b) => a[1] - b[1]);
	sortedArr=sortedArr.reverse()
	console.log(sortedArr)
	finalarray=[]
	for (var i = 0; i < sortedArr.length; i++) {
		if (typeof sortedArr[i][0] === "string"){
			finalarray.push(sortedArr[i]);
		}
	}

    const myDiv = document.getElementById("rec");
	console.log(finalarray)
	myDiv.innerHTML = finalarray.toString()+"</br>"+usersimscore.toString();



}

</script>

<script>
  function readInputs() {
    // Get the values entered in the input boxes
    const input1Value = document.getElementById("input1").value;
    const input2Value = document.getElementById("input2").value;
    const input3Value = document.getElementById("input3").value;

    // Log the values to the console
    console.log(`Input 1 value: ${input1Value}`);
    console.log(`Input 2 value: ${input2Value}`);
    console.log(`Input 3 value: ${input3Value}`);

	const arr = input3Value.split(",");
	console.log(arr);
	const item = {
	  id: input1Value,
	  rating: parseFloat(input2Value),
	  tags: arr,
	};

	const jsonString = JSON.stringify(item);
	base=jsonString;

  }


</script>

<script type="text/javascript">
base="";
arrayofparts=[];
function pasemessage2(value){
	console.log("myvalue",value)
	const jsonString = value;

	let parsedData = "";
	try {
	  parsedData = JSON.parse(jsonString);
	} catch (e) {
	  console.log("Invalid JSON string.");
	}

	if (parsedData !== "") {
	  arrayofparts.push(parsedData);
	  console.log(arrayofparts)
	}
	


}
function display(){
      const outputDiv = document.getElementById("output");
      let html = "";
      for (let i = 0; i < arrayofparts.length; i++) {
      	console.log(arrayofparts[i])
        html += "<p>id: " + arrayofparts[i].id + ", Age: " + arrayofparts[i].rating +", tags: " + arrayofparts[i].tags + "</p>";
      }
      outputDiv.innerHTML = html;
		console.log("mystuff")
		sim();
}

</script>
<script type="text/javascript">
 	const Matrix = require('matrix-api/Matrix').Matrix;
    const baseUrl = 'https://matrix.org/_matrix';
    const matrix  = new Matrix(baseUrl);
    matrix.addEventListener('logged-in', event => {
        console.log('Logged in!', event);
        // Start polling the server
        matrix.listenForServerEvents();
        // Act on events of only one type:
        matrix.addEventListener('m.room.message', event => {
            console.log('Message:', event.detail.content.body);
        });
        const roomId  = "!bbzmvbyRKWnfoLWXPA:matrix.org";
        matrix.joinRoom(roomId);


        console.log('about to sync')
        const sync = matrix.syncRoomHistory(
			roomId
			, message => console.log(message)
			, Date.now() - (7 * 24 * 60 * 60 * 1000)
			, null
			, { types: ['message.type.one', 'message.type.two', 'message.type.three'] }
		);


        function sm() {
            const evttype = 'm.room.message';
            const msgtype = 'm.text';
            const body    = base;
            if (base!="") {
            const message = {msgtype, body};
                matrix.putEvent(roomId, evttype, message)
                .then(response => values=response)
                .catch(error => console.error(error));
                base="";
            matrix.listenForServerEvents();
        	}
        }
        

        //document.querySelector("#mybutton").addEventListener('click',doFunction);
        sm()
        setInterval(sm,10000);
        run();
        counter=0;
        nomore=false
        array=[]
        function run(){


            const onEvents = response => {
                console.log(response);
                for (var i = 0; i < 10; i++) {
                	console.log(response.chunk[i].content['body'])
                	if (nomore==false){
                		array.push(response.chunk[i].content['body'])
                	}
                	if (response.chunk[i].content['body']=="stop"){
                		nomore=true;
                	}
                };
                

                counter++;

                if (counter!=1){
                	matrix.syncRoom(roomId).then(response =>{ onEvents(response); });
                }

                else{
                	console.log(array)
                	console.log("back")
                	for (var i = 0; i < array.length; i++) {
                		console.log(array[i]);
                		pasemessage2(array[i]);
	                };

                }
            }
            matrix.syncRoom(roomId).then(response =>{
                onEvents(response);
            });
            matrix.getEvent(roomId, "$NDu_O0Fjh7R7s6k2SmT7KuRPcol-n31fHexppqGa0Zk").then(response => console.log(response));
        }




    });

    document.querySelector("#but").addEventListener("click",event=>{

        const redirectUrl = location.origin + '/sin.html';
        matrix.initSso(redirectUrl);



    })
</script>




